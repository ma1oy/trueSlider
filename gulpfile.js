"use strict";function cinit(e){conf=YAML.load(cdir),data=conf.prj,plg=conf.plg,dest=conf.dir.dest,src=conf.dir.src,watch=Object.assign({},src,conf.dir.watch),e()}function go(){return require("through2").obj(function(e,s,a){a(null,e)})}function no(e){e()}function reload(e){$.browserSync.reload(),e()}var cdir="config.yml",gulp=require("gulp"),YAML=require("yamljs"),conf=YAML.load(cdir),$={},dest={},src={},watch={},data={},plg={};Object.keys(require("./package.json").devDependencies).forEach(function(e){$[e.replace("gulp-","").replace(/-[a-z]/g,function(e,s,a){return a[++s].toUpperCase()})]=require(e)}),cinit(function(){}),gulp.task("build:svg",function(e){gulp.src(src.svg).pipe(data.mcb.svg[0]?$.svgmin():go()).pipe($.rename(function(e){var s=e.dirname.split(e.sep);"."==s[0]?s.shift():!0,s.push(e.basename),e.basename=s.join("-")})).pipe($.svgstore({inlineSvg:!0})).pipe(gulp.dest(dest.svg)),e()}),gulp.task("build:html",function(e){gulp.src(src.html).pipe(data.pre.html?$[data.pre.html]({data:data}):go()).pipe(data.mcb.html[0]?$.htmlmin({collapseWhitespace:!0}):go()).pipe(gulp.dest(dest.html)),e()}),gulp.task("build:img",function(e){gulp.src(src.img).pipe(data.mcb.img[0]?$.imagemin({progressive:!0,svgoPlugins:[{removeViewBox:!1}],use:[$.imageminPngquant()],interlaced:!0}):go()).pipe(gulp.dest(dest.img)),e()}),gulp.task("build:css",function(e){gulp.src(src.css).pipe($.sourcemaps.init()).pipe(data.pre.css?$[data.pre.css](data.preOpt[data.pre.css]).on("error",$[data.pre.css].logError):go()).pipe($.autoprefixer(plg.autoprefixer)).pipe(data.mcb.css[0]?$.cleanCss():go()).pipe($.sourcemaps.write(dest.srcMap)).pipe(gulp.dest(dest.css)),e()}),gulp.task("build:js",function(e){gulp.src(src.js).pipe($.sourcemaps.init()).pipe(data.pre.js?$[data.pre.js](data.preOpt[data.pre.js]):go()).pipe(data.mcb.js[0]?$.uglify():go()).pipe($.sourcemaps.write(dest.srcMap)).pipe(gulp.dest(dest.js)),e()}),gulp.task("clean",function(e){var s=data.mcb,a=[];for(var t in s)s.hasOwnProperty(t)&&(s[t][1]?a.push(dest[t]):0);$.del(a,plg.del),e()}),gulp.task("build",gulp.series(gulp.parallel(data.mcb.css[2]?"build:css":no,data.mcb.js[2]?"build:js":no,data.mcb.svg[2]?"build:svg":no,data.mcb.img[2]?"build:img":no),data.mcb.html[2]?"build:html":no)),gulp.task("sync",function(e){$.browserSync.init(plg.browserSync),e()}),gulp.task("watch",function(e){gulp.watch(watch.html,gulp.series("build:html",reload)),gulp.watch(watch.css,gulp.series("build:css",reload)),gulp.watch(watch.js,gulp.series("build:js",reload)),gulp.watch(watch.svg,gulp.series("build:svg",reload)),gulp.watch(watch.img,gulp.series("build:img",reload)),gulp.watch(cdir,gulp.series(cinit,"build",reload)),e()}),gulp.task("default",gulp.parallel(gulp.series("build","sync"),"watch"));
